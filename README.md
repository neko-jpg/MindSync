# 🧠 MindSync（マインドシンク）— アプリケーション仕様書

このドキュメントは、AIメンタルヘルス共有コミュニティ「MindSync」の技術的な仕様と実装の詳細を記述するものです。この仕様書は、開発の進捗に合わせて継続的に更新され、常に最新の状態を保ちます。

## 1. コンセプト

**「孤独を、データで共感へ。」**

MindSyncは、AIがユーザーの音声から感情を解析し、似た心の状態の人々をマッチングする匿名性の高いSNSです。ユーザーは安心してメンタル状態を共有でき、孤独感の軽減と共感による癒やしを得ることを目指します。

- **ターゲットユーザー**: Z世代（18〜30歳）
- **コア体験**:
    1.  1日1分の音声入力による感情の可視化
    2.  AIによる感情が近いユーザーとのマッチング
    3.  心理学に基づいたメンタルケアミニゲーム

## 2. 主要機能

### 2.1. 感情同期
- 1日1回、最大60秒の音声を録音し、アップロードします。
- AIが音声を解析し、「気分スコア」と「感情の色」を算出します。
- 過去の感情の推移をグラフで確認できます。

### 2.2. 感情マッチング
- 直近の感情データに基づき、AIが類似した状態のユーザーを推薦します。
- マッチングが成立すると、匿名の1:1プライベートチャットを開始できます。

### 2.3. メンタルケアミニゲーム
- 5分程度で完了する、呼吸法やマインドフルネスなどのミニゲームを提供します。
- ユーザーの状態に応じて、AIが最適なゲームを推薦します（Phase2以降）。

## 3. アーキテクチャ

MindSyncは、Flutterによるクロスプラットフォームのクライアントアプリケーションと、SupabaseおよびカスタムWorkerによるバックエンドで構成されています。

```
Flutter (iOS/Android/Web)
  └─ Presentation: UI（Riverpod + Hooks）/ GoRouter
  └─ Domain: UseCase / Entities（Freezed）
  └─ Data: Repository（Dio/Supabase）
Backend
  ├─ Supabase (Auth, Postgres, Storage, Realtime)
  └─ Worker/API (FastAPI/Cloud Run)
      ├─ 音声前処理（VAD, MFCC）
      ├─ 感情推定（TFLite/ONNX）
      └─ マッチング（ベクトルDB / pgvector）
```

- **クライアント**: Flutter (iOS / Android / Web)
- **バックエンド**: Supabase (Auth, DB, Storage)
- **非同期処理**: Worker (FastAPI on Cloud Run) for 感情解析、マッチング
- **状態管理**: Riverpod
- **ルーティング**: GoRouter
- **データモデル**: Freezed

## 4. データモデル (主要エンティティ)
- **users**: ユーザー情報
- **emotion_logs**: 感情ログ（音声解析結果）
- **embeddings**: 音声データから生成されたベクトル
- **matches**: ユーザー間のマッチング情報
- **messages**: チャットメッセージ

データベースにはSupabaseのPostgreSQLを使用し、Row Level Security (RLS) を適用してユーザーデータのプライバシーを保護します。

## 5. 画面構成

- `/` (SplashScreen): 起動画面
- `/welcome`: ウェルカム画面
- `/timeline`: 感情ログの履歴画面
- `/record`: 音声録音画面
- `/match`: マッチング候補表示画面
- `/chat/:id`: チャット画面
- `/games`: ミニゲーム画面
- `/settings`: 設定画面

## 6. 実装済みの機能

### 6.1. アプリアイコン・スプラッシュスクリーン
- アプリアイコンを設定済み。
- 起動時にアニメーション付きのスプラッシュスクリーンを表示します。

*(このセクションは、新しい機能が実装されるたびに更新されます。)*

## 7. 開発ロードマップ

- **Phase 1 (M1-M2)**: MVP開発（音声入力＋感情可視化）
- **Phase 2 (M3)**: マッチング＋チャット実装
- **Phase 3 (M4)**: ミニゲーム＋ARモード実装
- **Phase 4 (M4以降)**: βテスト＆リリース
